# 计算机系统漫游

> 程序的执行需要哪些软硬件支持？

什么是计算机系统？

* 软件
  * 应用；算法；编程；操作系统
* 指令集架构
* 硬件
  * 微架构；功能部件；电路；器件

## 虚拟机观点下的计算机系统

* 第五级-虚拟机器：应用语言及其M5，具有L5机器语言（应用语言）
* 第四级-虚拟机器：高级语言
* 第三级-虚拟机器：汇编语言
* 第二级-虚拟机器：操作系统
* 第一级-实际机器：传统机器
* 第零级-实际机器：微程序机器

## 计算机的组织结构

### 冯诺依曼结构

![](img\冯诺依曼.jpg)

特点：

* 存储程序思想：计算机系统由硬件、软件构成
* 二进制：数据和程序指令以二进制编码，存储在内存中
* 顺序执行：程序中的指令依次被执行。

### 哈佛结构

![](img\哈佛结构.png)

特点：以主存为中心(DMA技术)、标准化总线、层次化存储体系

## 程序的翻译

程序从源程序转化成为目标程序是通过编译系统构成的

1. 源程序通过预处理器进行预处理，输出修改后的源程序
2. 进入编译器，输出汇编程序
3. 进行汇编器，输出二进制文件(可重定位目标程序)
4. 和外部库(例如使用了printf函数就要与print.o文件结合)连接，输出可执行目标程序(二进制)

## 程序的执行

## 机械特性

存储设备的机械特性：存储容量越大，访问速度越慢，处理器访问的开销就越大

内存：容量小（G） ,速度快(10GB/s)

磁盘：容量大（T） ,速度慢(100MB/s)

## 高速缓存-见第六章

## 操作系统

> 操作系统是应用软件和计算机硬件之间的桥梁
>
> 优点
>
> * 防止应用程序滥用操作系统
> * 向应用程序提供统一的机制完成对底层硬件的访问

![](img\OS.png)

* 进程：是对处理器、内存、外设的抽象
  * 虚拟内存：是对存储器和外设的抽象
    * 文件：是对I/O的抽象

进程：对正在运行程序的抽象
用户角度：独占系统
系统角度：多个任务并发执行
线程：进程的一个执行单元，一个进程中可以包含多个线程



## Amdahl定律

> 系统某个部分被加速时，其对系统整体性能的影响主要取决于该部分的重要程度和加速速度

公式：$S=\frac{T_{old}}{T_{new}}=\frac{1}{(1-\alpha)+\frac{\alpha}{k}}$

> 假设一台计算机的所有计算任务中 I/O 处理占 20%，当计算机中 CPU 性能提高为原来的 10 倍，而I/O 性能提高为原来的 2 倍时，系统总体性能会出现什么变化？



> 计算机执行某测试程序，其中含有大量浮点数据的处理操作，为提高性能可以采用两种方案，一是采用硬件实现求浮点数平方根(FPSQR)的操作，可以使该操作的速度提高10倍；另一种方案是提高所有浮点数据操作(FP)的速度，使其加快2倍。同时已知FPSQR操作时间占整个测试程序执行时间的20%，而FP操作占整个执行时间的50%，现比较两种方案



## 并发和并行

并发：指多个任务在同一个时间段内快速地轮换执行

* 线程级并发
  * 单处理器系统：多个任务轮流与系统交互
  * 多处理器系统：每个处理器完成一个任务。多个任务可以并行
    * 多核处理器：通过增加 CPU 的核心数，可以提高系统的性能
    * 超线程：同时多线程，允许cpu同时执行多个控制流

并行：是指多个任务同时进行，是真正意义上的同时执行

* 指令级并行：处理器可以同时执行多条指令的属性

单指令单数据和单指令多数据并行

![](img\SISD.png)



## 习题

对齐：不同数据存放有要求

字节大小-任意

字数据-最低有效位等于0

32位数据-起始地址必须是四的倍数，最低两位是00

64位-最低三位是000

栈破坏检测

栈随机化

 TLB加快页表访问速度

