
# 虚拟存储器

>传统内存管理的问题
>
>* 程序要一次性装入内存
>* 程序的局部性没有利用
>* 内存容易被破坏

## 交换与覆盖技术

**将暂停运行进程的地址空间与外存中由阻塞变为就绪进程的地址空间进行交换**

覆盖技术的原理：程序必要部分的代码和数据常驻内存；可选部分存放在外存中，在需要时才装入内存

结果

* 影响程序的结构
* 增加处理机的额外处理时间
* 没考虑程序局部性的影响

原因

* 为进程分配的空间是连续的
* 使用的地址都是物理地址

## 虚拟地址空间与寻址

虚拟存储器

* 保护进程地址空间的独立性
* 自动管理主存——辅存两级的存储层次

物理寻址：直接从主存中进行寻址

虚拟寻址：CPU从地址控制单元MMU进行虚拟寻址，地址控制单元在通过物理寻址从主存寻址

## 虚拟内存作为缓存工具

主要作用

* 作为缓存工具提高主存的使用效率
* 扩展程序的内存空间
* 作为管理工具提供系统必需的存储器管理的基本功能.

存储管理方式：段式、页式、段页式

主存作为缓存的结构

页表结构

| 虚拟页(省略) | 有效位 | 物理页 |
| ------------ | ------ | ------ |

页表标目：PTE=$2^{n-p}$，n为虚拟地址大小，页面大小为P=$2^p$ 

页命中



缺页

### 页调度策略

按需页面调度策略



预取式调度策略



页面分配-全相联映像



## 虚拟内存作为内存管理的工具

给进程分配独立的页表, 为进程建立独立的地址空间

简化链接、简化加载、简化共享、简化内存分配

## 虚拟内存作为内存保护的工具

## 页式存储

### 地址翻译

VPN-VPO  -->  PPN-PPO

已知：虚拟地址空间n位，物理地址m位，页面大小P

* VPO=PPO=$\log_2{P}$
* VPN=n-VPO
* PPN=m-PPO

### CPU处理步骤

### TLB快表优化

### 多级页表



